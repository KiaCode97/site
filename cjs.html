<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=10">
    <meta property="og:type" content="website">
    <meta property="og:title" content="checkout.js">
    <meta property="og:description" content="Библиотека позволяет собирать данные банковских карт пользователей на вашей стороне, без необходимости обрабатывать их на ваших серверах. Это значит, что пользователи смогут вводить все данные банковской карты прямо в вашей системе.">
    <meta property="og:site_name" content="romanespit.ru">
    <meta property="og:url" content="http://romanespit.ru/cjs">
    <meta property="og:image" content="https://raw.githubusercontent.com/romanespit/site/main/img/prev/cjs.jpg">
    <title>checkout.js</title>   
    <script src="https://static.yoomoney.ru/checkout-js/v1/checkout.js"></script>    
    <link rel="preconnect" href="https://sdk.yookassa.ru/checkout-js/api/v1/tokenize" crossorigin="anonymous">
    <link rel="stylesheet" href="css/utils.css">
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
    <link href="/manifest.json" rel="yandex-tableau-widget">
    <link rel="icon" href="img/kassa.png" >
</head>

<body>
    <!-- Yandex.Metrika counter -->
    <script type="text/javascript" >
        (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
        m[i].l=1*new Date();
        for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
        (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");
    
        ym(91200263, "init", {
            clickmap:true,
            trackLinks:true,
            accurateTrackBounce:true
        });
    </script>
    <noscript><div><img src="https://mc.yandex.ru/watch/91200263" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
    <!-- /Yandex.Metrika counter -->
    <div class="wrapper">
        <div class="header">
            <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="background-color: #1A3D8A" fill="white">
                <g>
                    <path d="m319.635877,112.750002c-79.784849,0 -143.250002,64.371967 -143.250002,143.250002c0,79.784849 64.371967,143.250002 143.250002,143.250002c78.878363,0 143.250002,-64.371967 143.250002,-143.250002c0,-78.878035 -64.37164,-143.250002 -143.250002,-143.250002zm0,195.835523c-29.012464,0 -53.491843,-24.479379 -53.491843,-53.492334c0,-29.012464 24.479379,-53.491843 53.491843,-53.491843c29.012791,0 53.49217,24.479379 53.49217,53.491843c-0.906813,29.919277 -24.479379,53.492334 -53.49217,53.492334z"/>
                    <path d="m174.519002,151.464652l0,209.070694l-50.904363,0l-65.447969,-209.070694l116.352332,0z"/>
                </g>
            </svg>
            <div>
                <h1>checkout.js</h1>
                <p><a href="/utilities"><span class="social-logo">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                        <polygon points="6.414 13 12.707 19.293 11.293 20.707 2.586 12 11.293 3.293 12.707 4.707 6.414 11 21 11 21 13"/>
                    </svg>                          
                    к утилитам</span></a>
                </p>
            </div>
        </div>  
        <div class="link-bar">                
            <div class="link-row">
                <a class="socials" target="_blank" href="https://yookassa.ru/developers/payment-acceptance/integration-scenarios/checkout-js/library-implementation">
                    <span class="social-logo">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                            <path fill-rule="evenodd" d="M21,22 L6,22 C4.34314575,22 3,20.6568542 3,19 L3,5 C3,3.34314575 4.34314575,2 6,2 L21,2 L20.9999995,18 C20.4477153,18 20,18.4477153 20,19 C20,19.5522847 20.4477153,20 21,20 L21,22 Z M18,19 C18,18.6493646 18.0601542,18.3127789 18.1707057,18 L6,18 C5.44771525,18 5,18.4477153 5,19 C5,19.5522847 5.44771525,20 6,20 L18.1707057,20 C18.0601542,19.6872211 18,19.3506354 18,19 Z M19,4 L6,4 C5.44771525,4 5,4.44771525 5,5 L5,16.1707057 C5.31277893,16.0601542 5.64936458,16 6,16 L19,16 L19,4 Z"/>
                        </svg>                          
                    </span>
                    документация
                </a>
            </div>            
        </div>
        <div class="main">
            <fieldset>
                <legend>Токенизация</legend>
                <div class="text-field">
                    <div class="text-field__group">
                        <input class="text-field__input" id="shopid" type="text" maxlength="6" inputmode="numeric" pattern="[0-9]{4,6}" name="shopid" style="width:100%;height: calc(1.5rem + 2px);" placeholder="903011">
                    </div>
                </div>
                <div class="text-field">
                    <div class="text-field__group" style="padding-top: 5px">             
                        <input class="text-field__input" type="text" id="cardnumber" maxlength="19" inputmode="numeric" pattern="[0-9]{13,19}" name="cardnumber" placeholder="Номер карты" style="width:14rem;height: calc(1.5rem + 2px);">
                    </div> 
                </div>
                <div class="text-field">
                    <div class="text-field__group" style="padding-top: 5px">                                   
                        <input class="text-field__input" maxlength="2" type="text" inputmode="numeric" pattern="[0-9]{2}" id="expM" name="expM" placeholder="MM" style="width:3rem;margin-right:5px;height: calc(1.5rem + 2px);"><span style="padding-top: 0.2rem">/</span>
                        <input class="text-field__input" maxlength="2" type="text" inputmode="numeric" pattern="[0-9]{2}" id="expY" name="expY" placeholder="ГГ" style="width:3rem;margin-left:5px;height: calc(1.5rem + 2px);">
                    </div> 
                </div>
                <div class="text-field">
                    <div class="text-field__group" style="padding-top: 5px">             
                        <input class="text-field__input" type="password" pattern="[0-9]{3}" inputmode="numeric" maxlength="3" id="cvv" name="cvv" placeholder="CVV/CVC" style="width:4rem;height: calc(1.5rem + 2px);">
                    </div> 
                </div>
                <details id="spoiler">
                    <summary style="margin: 0 auto;">Выбрать тестовую карту</summary>
                        <div style="width:100%;margin: 0 auto; ">
                            <table class="cardInfo">
                                <thead>
                                    <tr>
                                        <th>Система</th>
                                        <th>3Ds</th>
                                    </tr>
                                </thead>
                                <tfoot>
                                    <tr>
                                        <td colspan="2" id="error-scenario">
                                            <div class="links"><a  href="#">Ошибочные сценарии</a></div>
                                        </td>
                                    </tr>
                                </tfoot>
                                <tbody>
                                    <tr onclick="setCard(5555555555554477)" style="cursor: pointer;">
                                        <td>Mastercard</td><td>✔️</td></tr>
                                    <tr onclick="setCard(5555555555554444)" style="cursor: pointer;">
                                        <td>Mastercard</td><td>❌</td></tr>
                                    <tr onclick="setCard(6759649826438453)" style="cursor: pointer;">
                                        <td>Maestro</td><td>❌</td></tr>
                                    <tr onclick="setCard(4793128161644804)" style="cursor: pointer;">
                                        <td>Visa</td><td>✔️</td></tr>
                                    <tr onclick="setCard(4111111111111111)" style="cursor: pointer;">
                                        <td>Visa</td><td>❌</td></tr>
                                    <tr onclick="setCard(4175001000000017)" style="cursor: pointer;">
                                        <td>Visa Electron</td><td>❌</td></tr>
                                    <tr onclick="setCard(2200000000000004)" style="cursor: pointer;">
                                        <td>МИР</td><td>✔️</td></tr>
                                    <tr onclick="setCard(2202474301322987)" style="cursor: pointer;">
                                        <td>МИР</td><td>❌</td></tr>
                                    <tr onclick="setCard(370000000000002)" style="cursor: pointer;">
                                        <td>American Express</td><td>❌</td></tr>
                                    <tr onclick="setCard(3528000700000000)" style="cursor: pointer;">
                                        <td>JCB</td><td>❌</td></tr>
                                    <tr onclick="setCard(36700102000000)" style="cursor: pointer;">
                                        <td>Diners Club</td><td>❌</td></tr>
                                </tbody>
                                </tr>
                            </table>
                        </div>
                  </details>            
            </fieldset>
        </div>
        <div class="main">
            <fieldset style="background-color:#2B2B2E; border: 0px;">
                <!--<legend>Синоним карты/Ошибка</legend>-->
                <div class="text-field__group">
                    <textarea class="text-field__input tokenarea" style="height:16rem;" id="tokenarea" readonly placeholder="Синоним или ошибка появятся после токенизации"></textarea>
                    <svg id="copytoken" title="Нажмите для копирования" class="titled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"  fill="currentcolor">
                        <path fill-rule="evenodd" d="M16,16 L16,20 C16,21.1522847 15.1522847,22 14,22 L4,22 C2.84771525,22 2,21.1522847 2,20 L2,10 C2,8.84771525 2.84771525,8 4,8 L8,8 L8,4 C8,2.84771525 8.84771525,2 10,2 L20,2 C21.1522847,2 22,2.84771525 22,4 L22,14 C22,15.1522847 21.1522847,16 20,16 L16,16 Z M14,16 L10,16 C8.84771525,16 8,15.1522847 8,14 L8,10 L4,10 L4,20 L14,20 L14,16 Z M10,4 L10,14 L20,14 L20,4 L10,4 Z"/>
                    </svg>
                </div>
            </fieldset>
        </div>
        <div class="main">
            <button class="text-field__btn" type="button" id="tokenize" name="tokenize" style="margin: 0 auto;">Tokenize</button>
            <button class="text-field__btn" type="button" id="logs" name="logs" style="margin: 0 auto;">Logs</button>
                
        </div>    
    </div>
    <div class="footer">
        &copy;&nbsp;<script>document.write(/\d{4}/.exec(Date())[0])</script>&nbsp;&#8226;&nbsp;Made by <a href="/" target="_blank">romanespit</a> with <svg xmlns="http://www.w3.org/2000/svg" fill="#EF3E36" viewBox="0 0 16 16" style="height: 1.2em; vertical-align: middle" alt="LOVE">
            <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" />
            </svg><span style="margin: 0 0.4em;">|</span>
            <a href="https://www.donationalerts.com/r/romanespit" target="_blank" >buy me some food</a>
    </div>
    <script>
        texttocopy = "";
        const params = new URLSearchParams(window.location.search)
        urlshop = params.get('shopid');
        if(urlshop >= 1000 && urlshop <= 999999) { document.getElementById('shopid').value = urlshop; }
        document.querySelector("#copytoken").onclick = function() {
            if(!texttocopy) return alert('Нечего копировать');
            else {
                navigator.clipboard.writeText(texttocopy).then(() => {
                console.log('Content copied to clipboard');
                },() => {
                console.error('Failed to copy');
                });
            }
        }
        function setCard(cardnumber) {
            document.getElementById('cardnumber').value = cardnumber;
            document.getElementById('cvv').value = "123";
            document.getElementById('expM').value = "05";
            document.getElementById('expY').value = "30";
            document.getElementById("spoiler").removeAttribute("open");
        }
        document.querySelector("#error-scenario").onclick = function() {
            window.open("https://yookassa.ru/developers/payment-acceptance/testing-and-going-live/testing#test-bank-card-cancellation-details");
            document.getElementById("spoiler").removeAttribute("open");
        }
        document.querySelector("#logs").onclick = function() {
            token = document.getElementById("tokenarea").value; 
            if(token != "")
            { 
                window.open("https://kibana.yooteam.ru/app/discover#/?_g=(filters:!(),refreshInterval:(pause:!t,value:0),time:(from:now-1d,to:now))&_a=(columns:!(message.traceid,message.methodid,message.message),filters:!(),index:'backend-payment-api-v3-main-*',interval:auto,query:(language:lucene,query:'(%22"+ document.getElementById("shopid").value +"%22%20%22%D0%94%D0%BE%D0%BF%D0%A2%D1%80%D0%B5%D0%B9%D1%81%22%20%22%D0%94%D0%BE%D0%BF%D0%A2%D1%80%D0%B5%D0%B9%D1%81%22%20%22%D0%94%D0%BE%D0%BF%D0%A2%D1%80%D0%B5%D0%B9%D1%81%22%20%22%D0%94%D0%BE%D0%BF%D0%A2%D1%80%D0%B5%D0%B9%D1%81%22)%20%26%26%20(%22POST%2Fcheckout-js%2Fapi%2Fv1%2Ftokenize%22%20%22%22%20%22%22%20%22%22%20%22%22)%20%26%26%20NOT%20(%22%22%20%22%22%20%22%22%20%22%22%20%22%22)'),sort:!())");
            }
            else alert('Токен еще не сгенерирован!');
        }

        document.querySelector("#tokenize").onclick = function(){
            shop = document.getElementById("shopid").value;      
            if(shop >= 1000 && shop <= 999999)
            {
                history.pushState(null, null, '/cjs?shopid='+shop);
                try {
                    const checkout = YooMoneyCheckout(shop);
                    checkout.tokenize({
                    number: document.getElementById('cardnumber').value,
                    cvc: document.getElementById('cvv').value,
                    month: document.getElementById('expM').value,
                    year: document.getElementById('expY').value
                    }).then(res => {
                    if (res.status === 'success') {
                        const { paymentToken } = res.data.response;              
                        document.getElementById("tokenarea").value = paymentToken;
                        texttocopy = paymentToken;
                    }
                    if (res.status === 'error') {
                        const { type } = res.error;
                        document.getElementById("tokenarea").value = 'Type: '+res.error.type+'\nStatus Code: '+res.error.status_code;
                        const { params } = res.error;
                        if(res.error.params.length == 0) {
                            document.getElementById("tokenarea").value +="\nCode: "+res.error.code+"\nMessage: "+res.error.message;
                        }
                        else {
                            for(let i=0;i<res.error.params.length;i++)
                            {
                                document.getElementById("tokenarea").value +="\nCode: "+res.error.params[i].code+" Message: "+res.error.params[i].message;
                            }
                        }
                        texttocopy = "";
                    }                    
                    });
                } catch(error) {
                    console.log(error);
                }              
            }
            else alert('Неверный shopID');
        } 
    </script>
</body>
</html>