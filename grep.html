<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=10">
    <meta property="og:type" content="website">
    <meta property="og:title" content="Генератор GREP запроса">
    <meta property="og:description" content="Копаем логи">
    <meta property="og:site_name" content="romanespit.ru">
    <meta property="og:url" content="https://romanespit.ru/grep">
    <meta property="og:image" content="https://raw.githubusercontent.com/romanespit/site/main/img/prev/widgets.jpg">
    <title>Генератор GREP запроса</title>   
    <link rel="stylesheet" href="css/utils.css">
    <link rel="apple-touch-icon" href="img/apple-touch-icon.png">
    <link href="/manifest.json" rel="yandex-tableau-widget">
    <link rel="icon" href="img/kassa.png">
</head>
  <body>
    <div class="wrapper">
      <div class="header">
          <svg class="logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="background-color: #1A3D8A" fill="white">
              <g>
                  <path d="m319.635877,112.750002c-79.784849,0 -143.250002,64.371967 -143.250002,143.250002c0,79.784849 64.371967,143.250002 143.250002,143.250002c78.878363,0 143.250002,-64.371967 143.250002,-143.250002c0,-78.878035 -64.37164,-143.250002 -143.250002,-143.250002zm0,195.835523c-29.012464,0 -53.491843,-24.479379 -53.491843,-53.492334c0,-29.012464 24.479379,-53.491843 53.491843,-53.491843c29.012791,0 53.49217,24.479379 53.49217,53.491843c-0.906813,29.919277 -24.479379,53.492334 -53.49217,53.492334z"/>
                  <path d="m174.519002,151.464652l0,209.070694l-50.904363,0l-65.447969,-209.070694l116.352332,0z"/>
              </g>
          </svg>
          <div>
              <h1>grep</h1>
              <p><a href="/utilities"><span class="social-logo">
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentcolor">
                      <polygon points="6.414 13 12.707 19.293 11.293 20.707 2.586 12 11.293 3.293 12.707 4.707 6.414 11 21 11 21 13"/>
                  </svg>                          
                  к утилитам</span></a></p>
          </div>
      </div>  
      <div class="main">
          <fieldset>
              <legend>Настройки</legend>
              <div class="text-field">
                <label for="component">Компонента:</label>
                <select class="form-text form-input" name="component" id="component">
                  <option value="payment-api-v3">payment-api-v3</option>
                  <option value="shop">shop</option>
                  <option value="kassa">kassa</option>
                  <option value="deposit">deposit</option>
                </select>
              </div><br>
              <div class="text-field">
                <div class="text-field__group">
                  <input class="text-field__input" type="date" id="logsDate" style="width:50%;height: calc(1.5rem + 2px);"/>
                  <input class="text-field__input" type="phone" id="logsTime" maxlength="2" style="width:50%;height: calc(1.5rem + 2px);margin-left:10%" placeholder="Час"/>
                </div><br>
                <div class="text-field__group">
                  Применить форматирование логов 
                <label class="toggler-wrapper style-1" style="margin-bottom:5px;float: right;margin-left: 5%">
                  <input type="checkbox" id="formatStyle" value="formatted" checked="true">
                  <div class="toggler-slider" >
                      <div class="toggler-knob"></div>
                  </div>
                </label><br>
                </div>
                <br>
              <div class="text-field__group">
                <input class="text-field__input" id="expressionInput" style="width:100%;height: calc(1.5rem + 2px);" placeholder="Поисковое значение">
            </div>
              </div>             
          </fieldset>
      </div>
          
          <div class="main">
              <button class="text-field__btn" type="button" onclick="onClickGetExpression()" style="margin: 0 auto;">Получить выражение</button>
              
          </div>
          <div class="main">
            <fieldset style="background-color:#2B2B2E; border: 0px;">
                <div class="text-field__group">
                    <textarea class="text-field__input tokenarea" style="height:5rem;" id="tokenarea" readonly placeholder="Выражение будет здесь"></textarea>
                    <svg id="copytoken" title="Нажмите для копирования" class="titled" xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"  fill="currentcolor">
                        <path fill-rule="evenodd" d="M16,16 L16,20 C16,21.1522847 15.1522847,22 14,22 L4,22 C2.84771525,22 2,21.1522847 2,20 L2,10 C2,8.84771525 2.84771525,8 4,8 L8,8 L8,4 C8,2.84771525 8.84771525,2 10,2 L20,2 C21.1522847,2 22,2.84771525 22,4 L22,14 C22,15.1522847 21.1522847,16 20,16 L16,16 Z M14,16 L10,16 C8.84771525,16 8,15.1522847 8,14 L8,10 L4,10 L4,20 L14,20 L14,16 Z M10,4 L10,14 L20,14 L20,4 L10,4 Z"/>
                    </svg>
                </div>
            </fieldset>
        </div>
      </div>  
  <div class="footer">
      &copy;&nbsp;<script>document.write(/\d{4}/.exec(Date())[0])</script>&nbsp;&#8226;&nbsp;Made by <a href="/" target="_blank">romanespit</a> with <svg xmlns="http://www.w3.org/2000/svg" fill="#EF3E36" viewBox="0 0 16 16" style="height: 1.2em; vertical-align: middle" alt="LOVE">
          <path fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z" />
          </svg><span style="margin: 0 0.4em;">|</span>
          <a href="https://www.donationalerts.com/r/romanespit" target="_blank" >buy me some food</a>
  </div>
    <script>
      texttocopy = "";
      document.querySelector("#copytoken").onclick = function() {
          if(!texttocopy) return alert('Нечего копировать');
          else {
              navigator.clipboard.writeText(texttocopy).then(() => {
              console.log('Content copied to clipboard');
              },() => {
              console.error('Failed to copy');
              });
          }
      }
      const onClickGetExpression = () => {
        if (
          document.querySelector("#component").value &&
          document.querySelector("#logsDate").value &&
          document.querySelector("#expressionInput").value
        ) {
          const year = document.querySelector("#logsDate").value.split("-")[0];
          const month = document.querySelector("#logsDate").value.split("-")[1];
          const day = document.querySelector("#logsDate").value.split("-")[2];

          const expr = `find $HOME/logs/${
            document.querySelector("#component").value
          }/${year}/*/ -name "*${year}*${month}*${day}*${
            document.querySelector("#logsTime").value &&
            document.querySelector("#logsTime").value + "*"
          }.gz" -exec pigz -dc {} \\; | grep "${
            document.querySelector("#expressionInput").value
          }"${
            document.querySelector("#formatStyle").checked
              ? ' | jq -j \'.["@timestamp"]," ",.["traceid"]," ",.["methodid"]," ",.["name"],": ",.["message"], "\\n"\' | awk \'{print $0,"\\n\\n"}\''
              : ""
          }`;
          texttocopy = expr
          document.getElementById("tokenarea").value = expr
          /*navigator.clipboard.writeText(expr)
            .then(() => {
              console.log("ok");
            })
            .catch((err) => {
              console.log("Something went wrong", err);
            });*/
        } else {
          alert("Заполнены не все поля, проверь корректность ввода");
        }
      };
    </script>
  </body>
</html>
