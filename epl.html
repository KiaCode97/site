<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,maximum-scale=10">
    <title>Тестовые виджеты</title>    
    <link rel="stylesheet" href="style.css">
	<script src="https://yookassa.ru/checkout-widget/v1/checkout-widget.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>
<body style="font-family: 'Source Sans Pro', sans-serif">
    <div class="content-wrapper">
        <header class="header">
            <p style="font-size: 30px; margin: 0; padding: 10px;" title="Запрос на ЕПЛ">Запрос на ЕПЛ</p>
        </header>
        <br><button class="href_btn" type="button" id="sendRequest" style="width: 200px; height: 40px;">ЕПЛ</button>
    </div>
    <script>
        document.querySelector("#sendRequest").onclick = function() {
            sendReq();
        }
        reqBody = {
            "amount:": {
                "value": "1.00",
                "currency": "RUB"
            },
            capture: true,
            "confirmation": {
                "type": "embedded"
            }
        }
        function uuidv4() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }
        async function sendReq() {
            /*var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    alert(this.responseText);
                }
            };
            xhttp.open("POST", "https://api.yookassa.ru/v3/", true, "540993","live_mg_vLtqiLRLK5U8LqyTVtPu4Lt_FX2-G4b4gzuihQ0c");
            xhttp.setRequestHeader("Content-type", "application/json");
            xhttp.setRequestHeader("Idempotence-Key", uuidv4());
            alert(reqBody.responseText);
            xhttp.send(reqBody);
            xhttp.onload  = function() {
            jsonResponse = JSON.parse(xhttp.responseText);
            // do something with jsonResponse
            console.log(jsonResponse)*/
            const url = 'https://api.yookassa.ru/v3/';
            try {
            const response = await fetch(url, {
                mode: 'no-cors',
                method: 'POST', // или 'PUT'
                body: JSON.stringify(reqBody), // данные могут быть 'строкой' или {объектом}!
                headers: {
                'Content-Type': 'application/json',
                'Idempotence-Key': uuidv4(),
                'Authorization': '540993:live_mg_vLtqiLRLK5U8LqyTVtPu4Lt_FX2-G4b4gzuihQ0c',
                'Access-Control-Allow-Origin': '*',
                'Access-Control-Allow-Methods': 'DELETE, POST, GET, OPTIONS',
                'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With'
                }
            });
            const json = await response.json();
            console.log('Успех:', JSON.stringify(json));
            } catch (error) {
            console.log('Ошибка:', error);
            }
        }
    </script>
</body>
</html>